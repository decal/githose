#!/usr/bin/env bash
#
# Stand-alone executable script 
#
# Derek Callaway <decal {AT} sdf {D0T} org>
#
# Sat Jan  7 15:44:55 EST 2017
#

[[ $GITHOSE_DEBUG -ne 0 ]] && set -x || set +x

function _term() {
  echo "${purplef}$0${whitef}${boldon}:${boldoff} ${yellowf}Caught SIGTERM${boldon}!${boldoff} Ignoring...${reset}"

  sleep 0.22
}

trap _term SIGTERM

[ -d '../inc' ] && cd ..
[ -d '../../inc' ] && cd ../..

function configError {
  echo "${purplef}$0${whitef}${boldon}:${boldoff} ${yellowf}There was a syntax error in the configuration file${boldon}!${reset}"

  return
}

# Load shared scripts
source inc/colors && source inc/regexes && source inc/usages

# Load the configuration file
source etc/githose.conf 

if [[ $? -ne 0 ]]
  then configError 
  
  exit $?
fi

if [[ "$0" =~ gristhose$ ]]
  then if ( ! ( [ "$1" ] && [ "$2" ] ) || ! ( [[ $1 =~ ^clone ]] || [[ $1 =~ ^pull ]] ) )
    then gristhoseUsage

  exit -1
  fi
else
  if [[ "$0" =~ gisthose$ ]]
    then if ( ! ( [ "$1" ] && [ "$2" ] ) || ! ( [[ $1 =~ ^clone ]] || [[ $1 =~ ^pull ]] ) )
      then gisthoseUsage

      exit -1
    fi
  else
    if [[ "$0" =~ githose$ ]]
      then if ( ! ( [ "$1" ] && [ "$2" ] ) || ! ( [[ $1 =~ ^clone ]] || [[ $1 =~ ^pull ]] ) )
        then githoseUsage 

        exit -1
      fi
    else
      genericUsage

      exit -1
    fi
  fi
fi

export GITHOSE_ARGV0="`basename $0`"

declare -a GITHOSE_ARGSL=("${BASH_ARGV[@]}")

while [[ ${#GITHOSE_ARGSL} -gt 2 ]]
  do lib/driver $1 ${GITHOSE_ARGSL[@]:0:$(( ${#GITHOSE_ARGSL[*]} - 1 ))}

  declare -a GITHOSE_ARGSL_TEMP=("${GITHOSE_ARGSL[@]:1}")

  declare -a GITHOSE_ARGSL=("${GITHOSE_ARGSL_TEMP[@]}")

  echo
done

echo -n "${reset}"

sleep 1.64

# ♉ tw0 fingerz up, yup peas out  ♉#
exit 0
